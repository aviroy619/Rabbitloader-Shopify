RabbitLoader Shopify App â€” File Structure & Naming Contract
1. File & Folder Structure
/apps/rl-shopify
â”‚   .env                  # Environment variables (API keys, secrets, URLs)
â”‚   .gitattributes
â”‚   .gitignore
â”‚   app.js                # Main Express app entry
â”‚   package.json
â”‚   package-lock.json
â”‚   shopify.app.toml       # Shopify CLI config
â”‚   structure.txt          # â† THIS DOCUMENT
â”‚
â”œâ”€â”€ models
â”‚   â””â”€â”€ Shop.js           # Mongoose schema & model (ShopModel)
â”‚
â”œâ”€â”€ routes
â”‚   â”œâ”€â”€ api.js            # General API routes
â”‚   â”œâ”€â”€ shopify.js        # Shopify OAuth & core endpoints
â”‚   â””â”€â”€ shopifyConnect.js # RabbitLoader-specific connect/disconnect endpoints
â”‚
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ script.js         # Frontend logic (dashboard state mgmt)
â”‚   â”œâ”€â”€ style.css         # App styling
â”‚   â””â”€â”€ assets
â”‚       â””â”€â”€ RLlogo.png    # RabbitLoader branding
â”‚
â””â”€â”€ views
    â””â”€â”€ index.ejs         # Main embedded UI for Shopify Admin

2. Environment Variables (.env)

SHOPIFY_API_KEY

SHOPIFY_API_SECRET

SHOPIFY_SCOPES

APP_URL (public URL of app, e.g. https://shopify.rl8.in)

MONGO_URI

ğŸ“Œ Source of Truth: .env

3. Database Model (models/Shop.js)

Mongoose schema fields:

shop (string, unique, Shopify store domain)

access_token (Shopify OAuth token)

api_token (RabbitLoader API token)

short_id (RabbitLoader DID)

connected_at (Date)

history (Array of connect/disconnect events)

ğŸ“Œ Exported as:

const ShopModel = mongoose.models.Shop || mongoose.model("Shop", ShopSchema);


ğŸ“Œ Source of Truth: models/Shop.js

4. API Routes
/routes/shopify.js

/shopify/auth â†’ start OAuth

/shopify/auth/callback â†’ finish OAuth

/shopify/status â†’ check connection status

/routes/shopifyConnect.js

/shopify/store-token â†’ save RabbitLoader token

/shopify/disconnect â†’ disconnect RabbitLoader

ğŸ“Œ Source of Truth: routes/shopify.js (Shopify) + routes/shopifyConnect.js (RabbitLoader)

5. Connection State Variables

access_token â†’ Shopify OAuth token

api_token â†’ RabbitLoader API token

short_id â†’ RabbitLoader DID

connected_at â†’ timestamp of connection

history â†’ connection logs

ğŸ“Œ Source of Truth: ShopModel

6. Frontend Variables (script.js)

this.shop â†’ current store (?shop= param)

this.isRLConnected â†’ Boolean, from /shopify/status

this.currentDID â†’ RabbitLoader DID from DB

this.history â†’ past connection events

ğŸ“Œ Source of Truth: /shopify/status API

7. UI Elements (index.ejs)

IDs used in script.js:

#loadingState

#disconnectedState

#connectedState

#storeName, #storeNameDisconnected, #storeNameConnected

#activateBtn â†’ connect button

#disconnectBtn â†’ disconnect button

#flashMessages â†’ flash banner

ğŸ“Œ Source of Truth: views/index.ejs (HTML defines IDs)

8. Conflict Resolution Hierarchy

Database (ShopModel) â†’ real connection state

Routes (shopify.js, shopifyConnect.js) â†’ enforce DB truth

Frontend (script.js) â†’ displays backend state

Views (index.ejs) â†’ defines element IDs/classes

Environment (.env) â†’ runtime config values