RabbitLoader Shopify App — File Structure & Naming Contract
1. File & Folder Structure
/apps/rl-shopify
│   .env                  # Environment variables (API keys, secrets, URLs)
│   .gitattributes
│   .gitignore
│   app.js                # Main Express app entry
│   package.json
│   package-lock.json
│   shopify.app.toml       # Shopify CLI config
│   structure.txt          # ← THIS DOCUMENT
│
├── models
│   └── Shop.js           # Mongoose schema & model (ShopModel)
│
├── routes
│   ├── api.js            # General API routes
│   ├── shopify.js        # Shopify OAuth & core endpoints
│   └── shopifyConnect.js # RabbitLoader-specific connect/disconnect endpoints
│
├── public
│   ├── script.js         # Frontend logic (dashboard state mgmt)
│   ├── style.css         # App styling
│   └── assets
│       └── RLlogo.png    # RabbitLoader branding
│
└── views
    └── index.ejs         # Main embedded UI for Shopify Admin

2. Environment Variables (.env)

SHOPIFY_API_KEY

SHOPIFY_API_SECRET

SHOPIFY_SCOPES

APP_URL (public URL of app, e.g. https://shopify.rl8.in)

MONGO_URI

📌 Source of Truth: .env

3. Database Model (models/Shop.js)

Mongoose schema fields:

shop (string, unique, Shopify store domain)

access_token (Shopify OAuth token)

api_token (RabbitLoader API token)

short_id (RabbitLoader DID)

connected_at (Date)

history (Array of connect/disconnect events)

📌 Exported as:

const ShopModel = mongoose.models.Shop || mongoose.model("Shop", ShopSchema);


📌 Source of Truth: models/Shop.js

4. API Routes
/routes/shopify.js

/shopify/auth → start OAuth

/shopify/auth/callback → finish OAuth

/shopify/status → check connection status

/routes/shopifyConnect.js

/shopify/store-token → save RabbitLoader token

/shopify/disconnect → disconnect RabbitLoader

📌 Source of Truth: routes/shopify.js (Shopify) + routes/shopifyConnect.js (RabbitLoader)

5. Connection State Variables

access_token → Shopify OAuth token

api_token → RabbitLoader API token

short_id → RabbitLoader DID

connected_at → timestamp of connection

history → connection logs

📌 Source of Truth: ShopModel

6. Frontend Variables (script.js)

this.shop → current store (?shop= param)

this.isRLConnected → Boolean, from /shopify/status

this.currentDID → RabbitLoader DID from DB

this.history → past connection events

📌 Source of Truth: /shopify/status API

7. UI Elements (index.ejs)

IDs used in script.js:

#loadingState

#disconnectedState

#connectedState

#storeName, #storeNameDisconnected, #storeNameConnected

#activateBtn → connect button

#disconnectBtn → disconnect button

#flashMessages → flash banner

📌 Source of Truth: views/index.ejs (HTML defines IDs)

8. Conflict Resolution Hierarchy

Database (ShopModel) → real connection state

Routes (shopify.js, shopifyConnect.js) → enforce DB truth

Frontend (script.js) → displays backend state

Views (index.ejs) → defines element IDs/classes

Environment (.env) → runtime config values